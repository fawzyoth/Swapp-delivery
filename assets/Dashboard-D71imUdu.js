import{u as y,r,s as n,j as e}from"./index-CSAr9akK.js";import{D as m,S as E}from"./DeliveryLayout-CRAFALeb.js";import{C as D,P as h,a as u}from"./package-DINEK9ZC.js";import{X as g}from"./x-circle-C6p6cn9N.js";import{T as V}from"./trending-up-_hrZmKnu.js";import"./truck-D6n8440L.js";function R(){const i=y(),[s,x]=r.useState({todayVerifications:0,pendingVerifications:0,acceptedExchanges:0,rejectedExchanges:0}),[o,j]=r.useState([]),[p,f]=r.useState(!0);r.useEffect(()=>{b()},[]);const b=async()=>{try{const{data:{user:t}}=await n.auth.getUser();if(!t)return;const c=new Date;c.setHours(0,0,0,0);const{data:a}=await n.from("delivery_verifications").select("*, exchanges(*)").eq("delivery_person_id",t.id).order("created_at",{ascending:!1});if(a){const d=a.filter(l=>new Date(l.created_at)>=c).length,v=a.filter(l=>l.status==="accepted").length,w=a.filter(l=>l.status==="rejected").length;x({todayVerifications:d,pendingVerifications:0,acceptedExchanges:v,rejectedExchanges:w}),j(a.slice(0,5))}const{count:N}=await n.from("exchanges").select("*",{count:"exact",head:!0}).eq("status","in_transit");x(d=>({...d,pendingVerifications:N||0}))}catch(t){console.error("Error fetching dashboard data:",t)}finally{f(!1)}};return p?e.jsx(m,{children:e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-amber-600"})})}):e.jsx(m,{children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-900 mb-2",children:"Dashboard Livreur"}),e.jsx("p",{className:"text-slate-600",children:"Bienvenue dans votre espace de vérification des échanges"})]}),e.jsx("div",{className:"mb-8",children:e.jsxs("button",{onClick:()=>i("/delivery/scan"),className:"w-full md:w-auto flex items-center justify-center gap-3 px-8 py-4 bg-amber-600 hover:bg-amber-700 text-white rounded-xl font-medium transition-colors shadow-lg shadow-amber-200",children:[e.jsx(E,{className:"w-6 h-6"}),e.jsx("span",{className:"text-lg",children:"Scanner un bordereau"})]})}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-amber-100 rounded-lg",children:e.jsx(D,{className:"w-6 h-6 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-600",children:"Aujourd'hui"}),e.jsx("p",{className:"text-2xl font-bold text-slate-900",children:s.todayVerifications})]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:e.jsx(h,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-600",children:"En attente"}),e.jsx("p",{className:"text-2xl font-bold text-slate-900",children:s.pendingVerifications})]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-emerald-100 rounded-lg",children:e.jsx(u,{className:"w-6 h-6 text-emerald-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-600",children:"Acceptés"}),e.jsx("p",{className:"text-2xl font-bold text-slate-900",children:s.acceptedExchanges})]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-red-100 rounded-lg",children:e.jsx(g,{className:"w-6 h-6 text-red-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-600",children:"Refusés"}),e.jsx("p",{className:"text-2xl font-bold text-slate-900",children:s.rejectedExchanges})]})]})})]}),s.acceptedExchanges+s.rejectedExchanges>0&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6 mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(V,{className:"w-5 h-5 text-amber-600"}),e.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:"Taux d'acceptation"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex-1 bg-slate-100 rounded-full h-4 overflow-hidden",children:e.jsx("div",{className:"h-full bg-emerald-500 rounded-full transition-all duration-500",style:{width:`${s.acceptedExchanges/(s.acceptedExchanges+s.rejectedExchanges)*100}%`}})}),e.jsxs("span",{className:"text-lg font-bold text-slate-900",children:[Math.round(s.acceptedExchanges/(s.acceptedExchanges+s.rejectedExchanges)*100),"%"]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:"Vérifications récentes"}),e.jsx("button",{onClick:()=>i("/delivery/verifications"),className:"text-amber-600 hover:text-amber-700 text-sm font-medium",children:"Voir tout"})]}),o.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(h,{className:"w-12 h-12 text-slate-300 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-600",children:"Aucune vérification effectuée"}),e.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"Scannez un bordereau pour commencer"})]}):e.jsx("div",{className:"space-y-3",children:o.map(t=>{var c,a;return e.jsxs("div",{className:"flex items-center justify-between p-4 bg-slate-50 rounded-lg border border-slate-200",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-slate-900",children:((c=t.exchanges)==null?void 0:c.exchange_code)||"N/A"}),e.jsx("p",{className:"text-sm text-slate-600",children:((a=t.exchanges)==null?void 0:a.client_name)||"Client inconnu"}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:new Date(t.created_at).toLocaleDateString("fr-FR",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"})})]}),e.jsx("div",{className:"flex items-center gap-2",children:t.status==="accepted"?e.jsxs("span",{className:"flex items-center gap-1 px-3 py-1 bg-emerald-100 text-emerald-700 rounded-full text-sm font-medium",children:[e.jsx(u,{className:"w-4 h-4"}),"Accepté"]}):e.jsxs("span",{className:"flex items-center gap-1 px-3 py-1 bg-red-100 text-red-700 rounded-full text-sm font-medium",children:[e.jsx(g,{className:"w-4 h-4"}),"Refusé"]})})]},t.id)})})]})]})})}export{R as default};
