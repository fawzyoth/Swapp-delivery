import{u as A,r as l,s as j,j as e}from"./index-CSAr9akK.js";import{D as g}from"./DeliveryLayout-CRAFALeb.js";import{P as N,a as b,C as E}from"./package-DINEK9ZC.js";import{X as v}from"./x-circle-C6p6cn9N.js";import{c as w}from"./truck-D6n8440L.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=w("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=w("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);function X(){A();const[r,y]=l.useState([]),[o,_]=l.useState([]),[C,S]=l.useState(!0),[c,L]=l.useState(""),[i,V]=l.useState("all");l.useEffect(()=>{k()},[]),l.useEffect(()=>{R()},[c,i,r]);const k=async()=>{try{const{data:{user:s}}=await j.auth.getUser();if(!s)return;const{data:t,error:a}=await j.from("delivery_verifications").select("*, exchanges(*)").eq("delivery_person_id",s.id).order("created_at",{ascending:!1});if(a)throw a;y(t||[])}catch(s){console.error("Error fetching verifications:",s)}finally{S(!1)}},R=()=>{let s=[...r];if(i!=="all"&&(s=s.filter(t=>t.status===i)),c){const t=c.toLowerCase();s=s.filter(a=>{var d,x,m,h,u,f,p;return((x=(d=a.exchanges)==null?void 0:d.exchange_code)==null?void 0:x.toLowerCase().includes(t))||((h=(m=a.exchanges)==null?void 0:m.client_name)==null?void 0:h.toLowerCase().includes(t))||((f=(u=a.exchanges)==null?void 0:u.client_phone)==null?void 0:f.includes(t))||((p=a.bag_id)==null?void 0:p.toLowerCase().includes(t))})}_(s)};if(C)return e.jsx(g,{children:e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-amber-600"})})});const n={total:r.length,accepted:r.filter(s=>s.status==="accepted").length,rejected:r.filter(s=>s.status==="rejected").length};return e.jsx(g,{children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-900 mb-2",children:"Mes Vérifications"}),e.jsx("p",{className:"text-slate-600",children:"Historique de toutes vos vérifications d'échanges"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-slate-100 rounded-lg",children:e.jsx(N,{className:"w-5 h-5 text-slate-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-600",children:"Total"}),e.jsx("p",{className:"text-xl font-bold text-slate-900",children:n.total})]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-emerald-100 rounded-lg",children:e.jsx(b,{className:"w-5 h-5 text-emerald-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-600",children:"Acceptés"}),e.jsx("p",{className:"text-xl font-bold text-emerald-700",children:n.accepted})]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:e.jsx(v,{className:"w-5 h-5 text-red-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-600",children:"Refusés"}),e.jsx("p",{className:"text-xl font-bold text-red-700",children:n.rejected})]})]})})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-4 mb-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(T,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Rechercher par code, client ou sac...",value:c,onChange:s=>L(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-5 h-5 text-slate-400"}),e.jsxs("select",{value:i,onChange:s=>V(s.target.value),className:"px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500",children:[e.jsx("option",{value:"all",children:"Tous les statuts"}),e.jsx("option",{value:"accepted",children:"Acceptés"}),e.jsx("option",{value:"rejected",children:"Refusés"})]})]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:o.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx(N,{className:"w-16 h-16 text-slate-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"Aucune vérification trouvée"}),e.jsx("p",{className:"text-slate-600",children:c||i!=="all"?"Essayez de modifier vos filtres de recherche":"Vous n'avez pas encore effectué de vérification"})]}):e.jsx("div",{className:"divide-y divide-slate-200",children:o.map(s=>{var t,a,d;return e.jsx("div",{className:"p-4 hover:bg-slate-50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"font-mono font-medium text-slate-900",children:((t=s.exchanges)==null?void 0:t.exchange_code)||"N/A"}),s.status==="accepted"?e.jsxs("span",{className:"flex items-center gap-1 px-2 py-0.5 bg-emerald-100 text-emerald-700 rounded-full text-xs font-medium",children:[e.jsx(b,{className:"w-3 h-3"}),"Accepté"]}):e.jsxs("span",{className:"flex items-center gap-1 px-2 py-0.5 bg-red-100 text-red-700 rounded-full text-xs font-medium",children:[e.jsx(v,{className:"w-3 h-3"}),"Refusé"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-slate-600",children:[e.jsxs("span",{children:[e.jsx("strong",{children:"Client:"})," ",((a=s.exchanges)==null?void 0:a.client_name)||"Inconnu"]}),e.jsxs("span",{children:[e.jsx("strong",{children:"Tél:"})," ",((d=s.exchanges)==null?void 0:d.client_phone)||"N/A"]}),s.bag_id&&e.jsxs("span",{children:[e.jsx("strong",{children:"Sac:"})," ",s.bag_id]})]}),s.rejection_reason&&e.jsxs("p",{className:"mt-2 text-sm text-red-600 bg-red-50 px-3 py-1 rounded inline-block",children:["Raison: ",s.rejection_reason]})]}),e.jsx("div",{className:"text-right ml-4",children:e.jsxs("div",{className:"flex items-center gap-1 text-sm text-slate-500",children:[e.jsx(E,{className:"w-4 h-4"}),e.jsx("span",{children:new Date(s.created_at).toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})})]})})]})},s.id)})})})]})})}export{X as default};
