import{u as w,r as i,j as e,s}from"./index-CSAr9akK.js";import{A as j}from"./arrow-left-Dn1HXWcl.js";import{T as y}from"./truck-D6n8440L.js";function L(){const l=w(),[d,u]=i.useState(""),[x,h]=i.useState(""),[c,n]=i.useState(!1),[b,m]=i.useState("");i.useEffect(()=>{(async()=>{await s.auth.signOut()})()},[]);const p=async r=>{r.preventDefault(),r.stopPropagation(),n(!0),m("");try{console.log("Attempting login with:",d);const{data:t,error:a}=await s.auth.signInWithPassword({email:d.trim().toLowerCase(),password:x});if(console.log("Login response:",{data:t,error:a}),a)throw a;if(t.user){const{data:o}=await s.from("merchants").select("id").eq("email",t.user.email).maybeSingle();if(o)throw await s.auth.signOut(),new Error("Ce compte est un compte e-commerçant. Veuillez utiliser le portail e-commerçant.");const{data:f,error:v}=await s.from("delivery_persons").select("*").eq("email",t.user.email).maybeSingle();if(v||!f)throw await s.auth.signOut(),new Error("Compte livreur non trouvé. Veuillez utiliser le bon portail de connexion.");l("/delivery/dashboard")}}catch(t){console.error("Login error:",t),m(t.message||"Erreur de connexion. Vérifiez vos identifiants.")}finally{n(!1)}},g=async()=>{u("demo@livreur.com"),h("demo123456"),n(!0),m("");try{let{data:r,error:t}=await s.auth.signInWithPassword({email:"demo@livreur.com",password:"demo123456"});if(t&&t.message.includes("Invalid login credentials")){const{data:a,error:o}=await s.auth.signUp({email:"demo@livreur.com",password:"demo123456",options:{data:{name:"Livreur Demo",phone:"+216 70 000 001"}}});if(o)throw o;if(a.user){await s.from("delivery_persons").insert({id:a.user.id,email:"demo@livreur.com",name:"Livreur Demo",phone:"+216 70 000 001"}),l("/delivery/dashboard");return}}else if(t)throw t;if(r!=null&&r.user){const{data:a}=await s.from("merchants").select("id").eq("email",r.user.email).maybeSingle();if(a)throw await s.auth.signOut(),new Error("Ce compte est un compte e-commerçant.");const{data:o}=await s.from("delivery_persons").select("id").eq("email",r.user.email).maybeSingle();if(!o)throw await s.auth.signOut(),new Error("Compte livreur non trouvé.");l("/delivery/dashboard")}}catch(r){m(r.message||"Erreur de connexion. Veuillez créer le compte via Supabase Dashboard.")}finally{n(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-amber-50 via-white to-orange-50",children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("button",{onClick:()=>l("/"),className:"flex items-center text-slate-600 hover:text-slate-900 mb-6",children:[e.jsx(j,{className:"w-5 h-5 mr-2"}),"Retour à l'accueil"]}),e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-amber-100 rounded-full mb-4",children:e.jsx(y,{className:"w-8 h-8 text-amber-600"})}),e.jsx("h1",{className:"text-3xl font-bold text-slate-900 mb-2",children:"Connexion Livreur"}),e.jsx("p",{className:"text-slate-600",children:"Accédez à votre espace de vérification"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[b&&e.jsx("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:b}),e.jsxs("form",{onSubmit:p,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Email"}),e.jsx("input",{type:"email",required:!0,autoComplete:"email",autoCapitalize:"none",autoCorrect:"off",inputMode:"email",value:d,onChange:r=>u(r.target.value),placeholder:"votre@email.com",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500 text-base"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Mot de passe"}),e.jsx("input",{type:"password",required:!0,autoComplete:"current-password",value:x,onChange:r=>h(r.target.value),placeholder:"••••••••",className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500 text-base"})]}),e.jsx("button",{type:"submit",disabled:c,className:"w-full py-3 bg-amber-600 hover:bg-amber-700 disabled:bg-slate-300 text-white rounded-lg font-medium transition-colors",children:c?"Connexion...":"Se connecter"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-slate-300"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 bg-white text-slate-500",children:"ou"})})]}),e.jsx("button",{onClick:g,disabled:c,className:"w-full mt-4 py-3 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-lg font-medium transition-colors",children:"Connexion Demo"})]}),e.jsxs("div",{className:"mt-6 p-4 bg-amber-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-amber-800 font-medium mb-2",children:"Compte de démonstration:"}),e.jsxs("p",{className:"text-xs text-amber-700",children:["Email: demo@livreur.com",e.jsx("br",{}),"Mot de passe: demo123456"]})]})]})]})]})})}export{L as default};
